# Сценарии общения с Алисой (навык Холз)

Документ для тестирования, документации и доработки диалогов навыка HAULZ в Яндексе Алисе.

---

## 1. Первый запуск и авторизация

| Шаг | Пользователь | Алиса |
|-----|--------------|-------|
| 1.1 | «Запусти навык Холз» | Приветствие и предложение ввести код авторизации из мини‑приложения. |
| 1.2 | (без кода) «Какие перевозки в пути?» | «Авторизуйтесь, пожалуйста. Введите код авторизации из мини‑приложения Холз.» |
| 1.3 | Пользователь открывает мини‑приложение → Профиль → Голосовые помощники → Получить код для Алисы. | — |
| 1.4 | Называет код, например «**123456**» | «Вы авторизованы под компанией [Название компании]. Чем я могу вам помочь?» |
| 1.5 | Неверный или истёкший код «999999» | «Код не найден или истек. Получите новый код в мини‑приложении.» |

**Варианты фраз пользователя для кода:** «Код 123456», «123456», «Введи код 123456».

---

## 2. Перевозки в пути

| Шаг | Пользователь | Алиса |
|-----|--------------|-------|
| 2.1 | «Какие перевозки в пути?» / «Что в пути?» / «Перевозки в дороге» | Краткий ответ: «У вас N перевозок номера X и Y. Хотите подробнее?» (номера без ведущих нулей: 135702, 134556) или «Сейчас нет перевозок в пути.» |
| 2.2 | «Да» / «Подробнее» / «Хочу» | Подробный ответ по каждой перевозке: номер, статус, сумма, маршрут, оплата. |
| 2.3 | (без предварительного запроса) «Подробнее» | Может интерпретироваться как ответ на предыдущий вопрос (если в сессии был запрос «в пути»). |

**Формат номеров для голоса:** перевозки озвучиваются без ведущих нулей (например, 135702 и 134556, не 0135702).

**Синонимы запроса:** «перевозки в пути», «в пути», «в дороге», «что сейчас в пути».

---

## 3. Счета на оплату / требующие оплаты

| Шаг | Пользователь | Алиса |
|-----|--------------|-------|
| 3.1 | «Какие счета на оплату?» / «Что требует оплаты?» / «Неоплаченные перевозки» | Краткий ответ: «Требуют оплаты N перевозок номера X и Y. Хотите подробнее?» или «Перевозок, требующих оплаты, нет.» |
| 3.2 | «Да» / «Подробнее» | Подробности по каждой перевозке: номер, статус, сумма, маршрут, оплата. |

**Синонимы:** «счета», «счёт», «оплата», «что надо оплатить», «задолженность».

---

## 4. Отвязка компании (голосом)

| Шаг | Пользователь | Алиса |
|-----|--------------|-------|
| 4.1 | «Отвяжи компанию» / «Отвяжи заказчика» / «Отвяжи» | «Компания отвязана. Чтобы снова пользоваться навыком, получите новый код в мини‑приложении Холз.» |
| 4.2 | После отвязки: «Какие перевозки в пути?» | «Авторизуйтесь, пожалуйста. Введите код авторизации из мини‑приложения Холз.» |

*Реализовано в `api/alice.ts`.*

---

## 5. Проверка навыка (каталог Алисы)

| Шаг | Пользователь | Алиса |
|-----|--------------|-------|
| 5.1 | «Код проверки» / «Проверка навыка» | «Код проверки: [код из ALICE_VERIFICATION_CODE].» |

---

## 6. Прочие вопросы (через чат HAULZ)

Любой другой запрос передаётся в AI-чат с контекстом компании. Примеры:

| Пользователь | Ожидаемое поведение |
|--------------|---------------------|
| «Какой у меня активный заказчик?» | Ответ с названием компании из привязки. |
| «Контакты Холз» | Адреса, телефон, email, сайт. |
| «Статус перевозки номер 12345» | Поиск по контексту перевозок или предложение уточнить номер. |
| «Когда прибудет груз 12345?» | Ответ на основе данных по перевозке, если есть. |

При таймауте или ошибке бэкенда Алиса говорит: «Запрос обрабатывается дольше обычного. Повторите запрос через несколько секунд.»

---

## 6.1. Краткий статус «что в работе»

| Пользователь | Алиса |
|--------------|-------|
| «Что у меня в работе?», «Кратко что в работе», «Одна фраза» | Одна фраза: «В пути N перевозок, к оплате M.» или «Сейчас нет перевозок в пути и нет счетов к оплате.» |

---

## 6.2. Сводка за период

| Пользователь | Алиса |
|--------------|-------|
| «Сколько перевозок за сегодня?», «Перевозок за сегодня» | «У вас за сегодня N перевозок номера X и Y.» или «Перевозок за сегодня нет.» |
| «Сколько перевозок на этой неделе?», «Что пришло на этой неделе?» | Аналогично за неделю (номера без ведущих нулей). |

---

## 6.3. Статус по номеру перевозки

| Пользователь | Алиса |
|--------------|-------|
| «Статус перевозки 135702», «Перевозка 135702», «Груз 135702» | Детали по одной перевозке: номер, статус, сумма, маршрут, оплата. Или «Перевозку номер 135702 не нашла.» |

---

## 6.4. Выбор компании (несколько привязок)

| Пользователь | Алиса |
|--------------|-------|
| «Работай от имени компании [название]», «Переключись на компанию X» | «Теперь работаю от имени компании X. Чем могу помочь?» |
| Если привязана одна компания | «У вас привязана только одна компания. Добавьте ещё в мини‑приложении и введите новый код в Алисе.» |
| Если название не найдено | «Компанию «X» не нашла. Доступны: [список].» |

*Чтобы переключаться голосом, нужно несколько раз получить код в приложении для разных компаний и ввести коды в Алисе.*

---

## 7. Реализованные расширения (сводка)

- **Краткий статус «что в работе»:** «Что у меня в работе?», «Кратко что в работе» — ответ одной фразой: «В пути N перевозок, к оплате M.»
- **Сводка за период:** «Сколько перевозок за сегодня?», «Перевозок на этой неделе», «Что пришло на этой неделе?» — число перевозок и номера (без ведущих нулей).
- **Статус по номеру:** «Статус перевозки 135702», «Перевозка 135702», «Груз 135702» — детали по одной перевозке.
- **Выбор компании:** при нескольких привязанных компаниях — «Работай от имени компании X», «Переключись на компанию X» — переключение текущей компании в навыке.
- **Отвязка голосом:** см. блок 4.

## 8. Идеи на будущее

- **Напоминание об оплате:** «Напомни про неоплаченные счета завтра.»

---

## 9. Тест-кейсы (чек-лист)

- [ ] Запуск навыка без кода → просьба авторизоваться.
- [ ] Ввод верного кода → приветствие с названием компании.
- [ ] Ввод неверного/старого кода → сообщение «код не найден или истек».
- [ ] «Перевозки в пути» → краткий список или «нет перевозок».
- [ ] После «в пути» → «Подробнее» → полный список.
- [ ] «Что на оплату?» / «Счета на оплату» → краткий список или «нет».
- [ ] После «счета» → «Подробнее» → детали по перевозкам.
- [ ] «Код проверки» → вывод кода проверки навыка.
- [ ] «Что в работе?» → одна фраза: в пути N, к оплате M.
- [ ] «Сколько перевозок за сегодня?» / «на этой неделе» → число и номера.
- [ ] «Статус перевозки 135702» → детали по перевозке (номер без ведущих нулей).
- [ ] «Работай от имени компании X» → переключение при нескольких компаниях.
- [ ] «Отвяжи компанию» → отвязка и предложение получить новый код.
- [ ] Вопрос «Контакты Холз» → контакты из базы знаний.
- [ ] Таймаут 1С/чата → «Повторите запрос через несколько секунд».

---

*Файл: `docs/alice-scenarios.md`. Обновлять при изменении логики в `api/alice.ts`.*
