# Настройка Bitly для коротких ссылок

## Шаг 1: Создание токена

1. Зайди на [bitly.com](https://bitly.com) и зарегистрируйся/войди
2. Перейди в **Settings** → **Developer settings** → **Generic access token**
3. Создай новый токен (или используй существующий)
4. Скопируй токен

## Шаг 2: Добавь токен в Vercel

1. Зайди в **Vercel Dashboard** → твой проект → **Settings** → **Environment Variables**
2. Добавь переменную:
   - **Name**: `BITLY_ACCESS_TOKEN`
   - **Value**: `<твой-токен-из-Bitly>`
   - **Environment**: Production, Preview, Development (все)
3. Сохрани и **передеплой проект**

## Шаг 3: Проверка

После деплоя короткие ссылки должны работать:

```bash
# Создать короткую ссылку
curl -X POST https://your-domain.com/api/shorten \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com"}'

# Ответ:
# {
#   "shortUrl": "https://bit.ly/abc123",
#   "originalUrl": "https://example.com"
# }
```

## Как это работает

1. **Обычные ссылки** (`/api/shorten`):
   - Создаются напрямую через Bitly API
   - Bitly автоматически обрабатывает редиректы
   - Не требуется дополнительное хранилище

2. **Ссылки на документы** (`/api/shorten-doc`):
   - Создается токен в Redis (для безопасности)
   - Создается короткая ссылка через Bitly на `/api/doc/{token}`
   - При переходе по короткой ссылке → редирект на `/api/doc/{token}` → скачивание документа

## Бесплатный tier Bitly

- **1000 ссылок в месяц** — достаточно для большинства случаев
- **Базовая аналитика** — статистика переходов
- **Кастомные домены** — доступны в платных планах

## Миграция с Upstash Redis

Если у тебя были ссылки в Upstash Redis, они больше не будут работать после перехода на Bitly. Новые ссылки будут создаваться через Bitly.
